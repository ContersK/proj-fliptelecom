// Configuração do Cliente (Quem gera o TypeScript)
generator client {
  provider = "prisma-client-js"
}

// Configuração do Banco de Dados
datasource db {
  provider = "sqlite"
}

// --- SUAS TABELAS (MODELS) ---

model Gerencia {
  id       String @id @default(uuid())
  email    String @unique
  password String
  name     String
  role     String @default("SUPERVISOR") // "ADMIN" ou "SUPERVISOR"

  // Relação: Um usuário pode gerenciar um setor
  managedSetor Setor?
  
  // Notificações criadas por este usuário (admin)
  notificacoesCriadas   Notificacao[] @relation("NotificacoesCriadas")
  // Notificações recebidas por este usuário
  notificacoesRecebidas Notificacao[] @relation("NotificacoesRecebidas")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Setor {
  id   String @id @default(uuid())
  name String

  // Relação: Pertence a um supervisor (Gerencia)
  supervisorId String   @unique
  supervisor   Gerencia @relation(fields: [supervisorId], references: [id])

  // Relação: Setor tem funcionários
  funcionario Funcionario[]

  // Relação: Regras de comissão
  commissionRules RegrasDeComissao[]
  
  // Rastreamento de períodos fechados (formato: "2026-01" para janeiro/2026)
  periodosFechados String @default("") // JSON array stringificado ou CSV
}

model Funcionario {
  id              String            @id @default(cuid())
  nome            String
  email           String?           @unique
  telefone        String?
  cargo           String            @default("Suporte N1")
  turno           String // "A", "B", "Comercial", etc.
  status          String            @default("ATIVO") // "ATIVO", "FERIAS", "INATIVO"
  dataAdmissao    DateTime          @default(now())
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  setor           Setor?            @relation(fields: [setorId], references: [id])
  setorId         String?
  metricasMensais MetricasMensais[]
}

model MetricasMensais {
  id    String @id @default(uuid())
  month Int
  year  Int

  countNota5 Int @default(0)
  countNota4 Int @default(0)
  countNota3 Int @default(0)
  countNota2 Int @default(0)
  countNota1 Int @default(0)

  finalScore    Float?
  ValorComissao Float?
  
  // Status da comissão: PENDENTE (padrão), APROVADO ou REPROVADO
  statusComissao String @default("PENDENTE") // "PENDENTE", "APROVADO", "REPROVADO"

  funcionarioId String
  funcionario   Funcionario @relation(fields: [funcionarioId], references: [id])

  // Chave composta única: O funcionário só pode ter uma métrica por mês/ano
  @@unique([funcionarioId, month, year])
}

model RegrasDeComissao {
  id             String @id @default(uuid())
  PorcentagemMin Float
  ValorComissao  Float

  setorId String
  setor   Setor  @relation(fields: [setorId], references: [id])
}

model Notificacao {
  id        String   @id @default(uuid())
  title     String
  message   String
  type      String   @default("info") // "info", "warning", "success", "error"
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  
  // Quem criou a notificação (admin)
  createdById String?
  createdBy   Gerencia? @relation("NotificacoesCriadas", fields: [createdById], references: [id])
  
  // Para quem é a notificação (se null = para todos supervisores)
  targetId    String?
  target      Gerencia? @relation("NotificacoesRecebidas", fields: [targetId], references: [id])
}
